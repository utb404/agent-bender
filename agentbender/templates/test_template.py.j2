"""
Сгенерированный тест для: {{ test_case.title }}
Тест-кейс ID: {{ test_case.id }}
"""

import pytest
from playwright.sync_api import Page, expect
{% if page_objects %}
{% for page_class in page_objects.keys() %}
from pages.{{ page_class.lower().replace('page', '') }}_page import {{ page_class }}
{% endfor %}
{% endif %}
{% if gpn_qa_utils_enabled %}
from gpn_qa_utils import helpers
{% endif %}


{% if test_case.tags %}
{% for tag in test_case.tags %}
@pytest.mark.{{ tag }}
{% endfor %}
{% endif %}
class Test{{ test_case.id.replace('-', '') }}:
    """
    {{ test_case.title }}
    
    Описание: {{ test_case.description }}
    
    Ожидаемый результат: {{ test_case.expected_result }}
    {% if test_case.preconditions %}
    
    Предусловия:
    {% for precondition in test_case.preconditions %}
    - {{ precondition }}
    {% endfor %}
    {% endif %}
    """
    
    {% if use_fixtures %}
    @pytest.fixture(autouse=True)
    def setup(self, page: Page):
        """Подготовка тестового окружения"""
        {% if page_objects %}
        {% for page_class in page_objects.keys() %}
        self.{{ page_class.lower().replace('page', '') }}_page = {{ page_class }}(page)
        {% endfor %}
        {% endif %}
    {% endif %}
    
    def test_{{ test_case.id.lower().replace('-', '_') }}(self, page: Page):
        """
        {{ test_case.description }}
        """
        {% for step in test_case.steps %}
        # Шаг {{ step.step_number }}: {% if step.name %}{{ step.name }}: {% endif %}{{ step.description }}
        {% if step.is_structured %}
        {% if step.action == 'navigate' %}
        {% if step.value %}
        page.goto("{{ step.value }}")
        {% else %}
        # TODO: Указать URL для навигации
        {% endif %}
        {% elif step.action == 'fill' %}
        {% if step.target %}
        page.locator("{{ step.target }}").fill("{{ step.value or '' }}")
        {% else %}
        # TODO: Указать селектор для заполнения
        {% endif %}
        {% elif step.action == 'click' %}
        {% if step.target %}
        page.locator("{{ step.target }}").click()
        {% else %}
        # TODO: Указать селектор для клика
        {% endif %}
        {% elif step.action == 'verify' %}
        {% if step.target %}
        expect(page.locator("{{ step.target }}")).to_be_visible()
        {% else %}
        # TODO: Указать селектор для проверки
        {% endif %}
        {% elif step.action == 'download' %}
        {% if step.target %}
        # Скачивание файла
        async with page.expect_download() as download_info:
            page.locator("{{ step.target }}").click()
        download = await download_info.value
        # TODO: Сохранить файл в нужное место
        {% else %}
        # TODO: Реализовать скачивание на основе описания
        {% endif %}
        {% else %}
        # TODO: Реализовать действие {{ step.action or 'неизвестное' }}
        {% endif %}
        {% else %}
        # Шаг еще не обработан StepGenerator
        # Описание: {{ step.description }}
        {% if step.expectedResult %}
        # Ожидаемый результат: {{ step.expectedResult }}
        {% endif %}
        # TODO: Реализовать действие на основе описания
        {% endif %}
        {% endfor %}
        
        # Проверка ожидаемого результата
        # {{ test_case.expected_result }}

